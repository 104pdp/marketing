# Цель проекта

Оптимизация маркетинговых кампаний интернет-магазина за счёт прогнозирования вероятности покупки каждым клиентом в ближайшие **90 дней**.  
Модель помогает определить, **кому стоит отправить персонализированное предложение**, чтобы повысить конверсию и сократить лишние расходы на коммуникации.


#  Этапы работы

1. **Загрузка и очистка данных** — объединены данные о покупках, сообщениях и событиях клиентов.  
2. **Формирование признаков** — рассчитаны показатели активности, взаимодействия с рассылками, частоты категорий и динамика покупок.  
3. **Обучение моделей** — протестированы несколько алгоритмов (LogReg, DecisionTree, KNN, GBC, CatBoost, LGBM, XGB).  
4. **Оптимизация порогов классификации** — построены зависимости F1, F2 и прибыли от порога вероятности.  
5. **Интерпретация модели** — проведён анализ важности признаков с помощью **SHAP**.  
6. **Выбор бизнес-стратегии** — подобраны оптимальные сценарии по F2 (расширенный охват) и по прибыли/F1 (максимальная эффективность).


#  Результаты подбора порогов

| Метрика | Оптимальный порог | Precision | Recall | F-мера | Комментарий |
|----------|-------------------|-----------|---------|---------|--------------|
| **F1** | 0.070 | 0.131 | 0.229 | 0.166 | Сбалансированная стратегия (качество + экономия бюджета) |
| **F2** | 0.050 | 0.097 | 0.333 | 0.225 | Расширенный охват (максимум полноты) |
| **Profit** | 0.070 | — | — | — | Максимальная чистая прибыль (+190) |


#  Анализ изменения F1, F2 и прибыли

На графике показано, как изменяются **F1**, **F2** и **чистая прибыль (NetProfit)** в зависимости от порога вероятности классификации:

-  **Зелёная линия — прибыль (NetProfit)**  
  Максимум при пороге **0.070** (прибыль ≈ +190).  
  Это наиболее выгодный вариант для бизнеса.

-  **Синяя пунктирная — F2**  
  Максимум при пороге **0.050**, даёт больший охват клиентов (высокий Recall), но повышает расходы.

-  **Красная точечная — F1**  
  Балансирует точность и полноту, не максимизируя прибыль, но обеспечивает устойчивое качество.

**Вывод:**
- Порог **0.05 (F2)** — если важно не пропустить клиентов.  
- Порог **0.07 (F1/Profit)** — если важно сохранить рентабельность и снизить ложные срабатывания.


# Матрица ошибок при пороге F1 = 0.07

|                | Предсказано: Нет | Предсказано: Да |
|----------------|------------------|------------------|
| **Факт: Нет**  | 11857 | 366 |
| **Факт: Да**   | 185   | 55  |

Интерпретация:
- **55 покупателей** модель определила верно (TP).  
- **366 ложных срабатываний (FP)** — маркетинг затратил средства, но без результата.  
- **185 пропущенных покупателей (FN)** — часть клиентов не попала в рассылку.  

При таком пороге модель обеспечивает **приемлемый охват и чистую прибыль +190**, что делает стратегию сбалансированной между точностью и затратами.

# SHAP-анализ важности признаков

По результатам SHAP для лучшей модели (**LightGBM**) определены ключевые факторы, влияющие на покупку:

| Признак | Интерпретация |
|----------|----------------|
| **event_click** | Клики по рассылкам — главный сигнал заинтересованности. |
| **days_since_last** | Чем меньше времени с последней покупки — тем выше вероятность новой. |
| **event_open** | Открытия пушей/писем повышают вероятность покупки. |
| **avg_price** | Средний чек: пользователи “среднего и выше” сегмента чаще покупают повторно. |
| **days_active** | Активность в течение долгого времени — индикатор лояльности. |
| **event_purchase** | История покупок усиливает прогноз вероятности новой. |
| **channel_mobile_push** | Push-канал положительно влияет на вовлечённость. |
| **message_id_nunique** | Разнообразие сообщений удерживает интерес клиента. |
| **event_unsubscribe** | Отписки — отрицательный сигнал, снижающий шанс покупки. |

---

#  Выводы для бизнеса

1. **Поведенческие признаки** — ключевые. “Свежесть” активности (`days_since_last`) и вовлечённость (`event_click`, `event_open`) наиболее влиятельны.  
2. **Каналы коммуникации** — push и email остаются эффективными при разумной частоте.  
3. **Персонализация** — использование категорий товаров (`cat*_freq`) помогает точнее подбирать офферы.  
4. **Исключение нежелательных клиентов** — отписавшихся и жалующихся пользователей нужно исключать из кампаний.  
5. **Оптимизация бюджета** — порог 0.07 обеспечивает лучший баланс между затратами и прибылью.


# Практическое применение модели

**Что делает модель:**  
предсказывает вероятность покупки в течение **90 дней**.

**Как использовать:**
1. Рассчитать `y_proba` для всех клиентов.  
2. Применить выбранный порог:
   - `0.05` — приоритет полноты (больший охват).  
   - `0.07` — приоритет прибыли (оптимизация бюджета).  
3. Отобрать **топ-N клиентов** по вероятности.  
4. Отправить персонализированные офферы по их ключевым категориям.  
5. Отслеживать эффективность кампании (конверсию, ROI).


#  Финальный вывод

Построенная модель на основе **LightGBM** успешно решает задачу прогнозирования вероятности покупки клиентов.  
Она даёт маркетингу инструмент для **управления приоритетами кампаний** —  
можно балансировать между **широким охватом (F2)** и **максимизацией прибыли (F1/Profit)**.  

Благодаря **SHAP-анализу** модель остаётся интерпретируемой и даёт чёткое понимание, **какие действия и признаки реально влияют на покупку**.
